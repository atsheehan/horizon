## Feedster

Feedster is designed to make it easy to create newsfeeds for users.

### Designating an actor

Usually, the actor, or the object that is performing actions that result in the creation of feed activity are 
instances of `User`.

In order to take advantage of Actor related functions do the following in your actor class:

```ruby
class User < ActiveRecord::Base
  include Feedster::Actor
end
```

This will give you the `generated_feed_items` association, 
where you can get the list of feed items that the user generated as the actor.

### Designating a recipient

Usually, the recipients of a `feed_item` is the one that cares about the activity generated by the actor are 
instances of `User`. 

In order to take advantage of Recipient related functions do the following in your recipient class.

```ruby
class User < ActiveRecord::Base
  include Feedster::Recipient
end
```

This will give you the `received_feed_items` association,
where you can get the list of feed items that the recipient should be concerned about.

### Creating a feed item subject

Consider the following setup, where a users is monitoring a category:

```ruby
class Category < ActiveRecord::Base
  has_many :widgets
  belongs_to :watching_user,
    class_name: 'User',
    foreign_key: 'watching_user_id'
end

class Widget < ActiveRecord::Base
  belongs_to :categories

  belongs_to :user

  include Feedster::Subject
  generates_feed_item :create,
    actor: ->(widget){ widget.user },
    recipients: ->(widget) { [widget.category.watching_user] }
end
```

Here, the class method `generates_feed_item` states that we want to create a feed when a `Widget` instance 
is created. 

We specify a proc for the option `:actor` that returns the user that performed the action 
(in this case, the widget's creator). The actor is not required for activity generated by the system or staff.

We specify a proc for the option `:recipients` that returns a collection of users that would care about this action.

### Creating a view of the feed item

You must create a view_object class that implements `title`, `body`, and `created_at` methods. 
This class should inherit from `Feedster::Decorator`.

```ruby
class Feedster::WidgetCreatedDecorator < Feedster::Decorator
  def title
    link_to(@feed_item.subject, widget_path(@feed_item.subject))
  end

  def body
    'created'
  end

  def created_at
    @feed_item.subject.created_at
  end
end
```

You then must add the correlation between the feed item's subject and the view object in `app/view_objects/feedster/decorated_collection`.


```ruby
class Feedster::DecoratedCollection
  protected
  def decorator_map
    @decorator_map ||= {
      'Widget' => {
        'create' => Feedster::WidgetCreatedDecorator
      }
    }
  end
end
```

Then, in a controller you can get a decorated list of feed items like so:

```ruby
@feed_items = Feedster::DecoratedCollection.new(
      current_user.received_feed_items.order('created_at DESC').limit(25)).decorate
```

This gives you a consistent way to display feed items regardless of their subject.

